# services/normalize.py
import re

EMOJI_RE = re.compile(r'[\u2600-\u26FF\u2700-\u27BF\U0001F000-\U0001FAFF]+')
SPACES_RE = re.compile(r'\s+')

ALIASES = {
    "Ð²Ð¸Ð·Ð¸Ñ‚ÐºÐ¸": {"Ð²Ð¸Ð·Ð¸Ñ‚ÐºÐ¸","ðŸªª Ð²Ð¸Ð·Ð¸Ñ‚ÐºÐ¸","Ð²Ð¸Ð·Ð¸Ñ‚ÐºÐ°","Ð²Ð¸Ð·Ð¸Ñ‚ÐºÐ° 90x50","Ð²Ð¸Ð·Ð¸Ñ‚ÐºÐ° 90Ã—50"},
    "Ñ„Ð»Ð°ÐµÑ€Ñ‹": {"Ñ„Ð»Ð°ÐµÑ€Ñ‹","ðŸ“„ Ñ„Ð»Ð°ÐµÑ€Ñ‹","Ð±ÑƒÐºÐ»ÐµÑ‚Ñ‹","Ð±ÑƒÐºÐ»ÐµÑ‚"},
    "Ð±Ð°Ð½Ð½ÐµÑ€Ñ‹": {"Ð±Ð°Ð½Ð½ÐµÑ€Ñ‹","ðŸ–¼ Ð±Ð°Ð½Ð½ÐµÑ€Ñ‹","Ð±Ð°Ð½Ð½ÐµÑ€"},
    "Ð¿Ð»Ð°ÐºÐ°Ñ‚Ñ‹": {"Ð¿Ð»Ð°ÐºÐ°Ñ‚Ñ‹","ðŸ“° Ð¿Ð»Ð°ÐºÐ°Ñ‚Ñ‹","Ð¿Ð»Ð°ÐºÐ°Ñ‚"},
    "Ð½Ð°ÐºÐ»ÐµÐ¹ÐºÐ¸": {"Ð½Ð°ÐºÐ»ÐµÐ¹ÐºÐ¸","ðŸ· Ð½Ð°ÐºÐ»ÐµÐ¹ÐºÐ¸","Ð½Ð°ÐºÐ»ÐµÐ¹ÐºÐ°"},
    "Ð»Ð¸ÑÑ‚Ñ‹": {"Ð»Ð¸ÑÑ‚Ñ‹","ðŸ“š Ð»Ð¸ÑÑ‚Ñ‹","Ð»Ð¸ÑÑ‚Ñ‹ Ð°4","Ð»Ð¸ÑÑ‚Ñ‹ Ð°3"},
    "Ð´Ñ€ÑƒÐ³Ð¾Ðµ": {"Ð´Ñ€ÑƒÐ³Ð¾Ðµ","ðŸ“¦ Ð´Ñ€ÑƒÐ³Ð¾Ðµ"},
    "Ð¾Ð±Ñ‹Ñ‡Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ": {"Ð¾Ð±Ñ‹Ñ‡Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ","ðŸ–¨ Ð¾Ð±Ñ‹Ñ‡Ð½Ð°Ñ Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ"},
    "Ð½Ð°Ð·Ð°Ð´": {"Ð½Ð°Ð·Ð°Ð´","â¬…ï¸ Ð½Ð°Ð·Ð°Ð´","/back","back"},
    "Ð¾Ñ‚Ð¼ÐµÐ½Ð°": {"Ð¾Ñ‚Ð¼ÐµÐ½Ð°","âŒ Ð¾Ñ‚Ð¼ÐµÐ½Ð°","/cancel","cancel"},
    "Ð´Ð°Ð»ÐµÐµ": {"Ð´Ð°Ð»ÐµÐµ","âž¡ï¸ Ð´Ð°Ð»ÐµÐµ","/next","next"},
    "Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ": {"Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ","â­ï¸ Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ","skip"},
}

def norm_btn(text: str) -> str:
    t = text or ""
    t = EMOJI_RE.sub("", t)
    t = t.lower().strip()
    t = SPACES_RE.sub(" ", t)
    return t

def is_btn(text: str, key: str) -> bool:
    t = norm_btn(text)
    return any(t == norm_btn(a) for a in ALIASES.get(key, {key}))

def just_text(text: str) -> str:
    return SPACES_RE.sub(" ", EMOJI_RE.sub("", text or "")).strip()